import { decodeSessionCookie, AUTH_COOKIE_NAME } from "vuefire/server";
import { getCookie } from "h3";
import { DECODED_ID_TOKEN_SYMBOL } from "../constants.mjs";
import { defineNuxtPlugin, useRequestEvent } from "#app";
export default defineNuxtPlugin(async (nuxtApp) => {
  const event = useRequestEvent();
  const adminApp = nuxtApp.$firebaseAdminApp;
  const decodedToken = await decodeSessionCookie(
    getCookie(event, AUTH_COOKIE_NAME),
    adminApp
  );
  nuxtApp[
    // we cannot use symbol to index
    DECODED_ID_TOKEN_SYMBOL
  ] = decodedToken;
});
