import { createHead as createClientHead } from "@unhead/vue";
import { renderDOMHead } from "@unhead/dom";
import { defineNuxtPlugin } from "#app/nuxt";
import unheadPlugins from "#build/unhead-plugins.mjs";
export default defineNuxtPlugin({
  name: "nuxt:head",
  setup(nuxtApp) {
    const head = import.meta.server ? nuxtApp.ssrContext.head : createClientHead({
      plugins: unheadPlugins
    });
    nuxtApp.vueApp.use(head);
    if (import.meta.client) {
      let pauseDOMUpdates = true;
      const syncHead = async () => {
        pauseDOMUpdates = false;
        await renderDOMHead(head);
      };
      head.hooks.hook("dom:beforeRender", (context) => {
        context.shouldRender = !pauseDOMUpdates;
      });
      nuxtApp.hooks.hook("page:start", () => {
        pauseDOMUpdates = true;
      });
      nuxtApp.hooks.hook("page:finish", syncHead);
      nuxtApp.hooks.hook("app:suspense:resolve", syncHead);
    }
  }
});
